<script>
    var player;
    var playerReady = false;
    // Remueve window.checkPlayerReadyResult si vas a usar un callback.
    // window.checkPlayerReadyResult = false; // Ya no es necesario si usas el callback

    function onYouTubeIframeAPIReady() {
        console.log("onYouTubeIframeAPIReady: La API de YouTube está lista.");

        const params = new URLSearchParams(window.location.search);
        const videoId = params.get("videoId") || "dQw4w9WgXcQ";

        player = new YT.Player('player', {
            width: '100%',
            height: '100%',
            videoId: videoId,
            playerVars: {
                'controls': 0,
                'modestbranding': 1,
                'autoplay': 0
            },
            events: {
                'onReady': onPlayerReady,
                'onError': onPlayerError
            }
        });
    }

    function onPlayerReady(event) {
        console.log("onPlayerReady: ¡Reproductor de YouTube listo y en pausa!");
        playerReady = true;

        // **NUEVO: Llama a una función en Unity para notificar que el reproductor está listo**
        // Envía un mensaje con el valor "true"
        if (window.unityWebView) { // TLab WebView puede exponer un objeto global para esto
            window.unityWebView.postMessage('PlayerReady', 'true');
            console.log("JS: Mensaje 'PlayerReady: true' enviado a Unity.");
        } else {
            console.warn("JS: window.unityWebView no está disponible para enviar el mensaje a Unity.");
        }
    }

    function onPlayerError(event) {
        console.error("onPlayerError: Error del reproductor de YouTube. Código de error:", event.data);
    }

    // Estas funciones ya no serían necesarias si usas el callback para la inicialización
    // function checkPlayerReady() { /* ... */ }
    // function updateCheckPlayerReadyResult() { /* ... */ }

    function playVideo() {
        if (player) {
            player.playVideo();
            console.log("Comando: Reproducir video.");
        } else {
            console.warn("Comando: Reproducir video - Reproductor no disponible.");
        }
    }

    function pauseVideo() {
        if (player) {
            player.pauseVideo();
            console.log("Comando: Pausar video.");
        } else {
            console.warn("Comando: Pausar video - Reproductor no disponible.");
        }
    }

    function seekTo(t) {
        if (player) {
            player.seekTo(t, true);
            console.log("Comando: Ir al segundo " + t + ".");
        } else {
            console.warn("Comando: Ir al segundo - Reproductor no disponible.");
        }
    }
</script>
