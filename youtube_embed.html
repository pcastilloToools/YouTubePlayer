<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Youtube IFrame API</title>
    <script>
      let player;
      let isPlayerReady = false;

      // UnityBridge que Unity puede usar para enviar mensajes al HTML
      window.UnityBridge = {
        onMessage: function (msg) {
          console.log("üì© Mensaje recibido desde Unity:", msg);

          // Aqu√≠ interpretamos los comandos enviados desde Unity
          switch (msg) {
            case "PLAY":
              playVideo();
              break;
            case "PAUSE":
              pauseVideo();
              break;
            default:
              console.warn("‚ö†Ô∏è Comando no reconocido:", msg);
              break;
          }
        }
      };

      function onYouTubeIframeAPIReady() {
        console.log("‚úÖ API de YouTube lista.");
        player = new YT.Player("player", {
          height: "390",
          width: "640",
          videoId: "M7lc1UVf-VE",
          events: {
            onReady: onPlayerReady,
            onStateChange: onPlayerStateChange,
          },
        });
      }

      function onPlayerReady(event) {
        console.log("‚úÖ Reproductor listo.");
        isPlayerReady = true;

        // Auto-play
        event.target.playVideo();

        // Enviar mensaje a Unity
        postMessageToUnity("PLAYER_READY");
      }

      function onPlayerStateChange(event) {
        console.log("üé¨ Estado del reproductor:", event.data);
      }

      function playVideo() {
        if (isPlayerReady && player) {
          player.playVideo();
          console.log("‚ñ∂Ô∏è Play desde JS");
        }
      }

      function pauseVideo() {
        if (isPlayerReady && player) {
          player.pauseVideo();
          console.log("‚è∏Ô∏è Pause desde JS");
        }
      }

      function postMessageToUnity(message) {
        if (window.Unity && typeof window.Unity.call === "function") {
          window.Unity.call(message);
        } else {
          console.warn("‚ö†Ô∏è Unity.call no est√° disponible para enviar:", message);
        }
      }

      // Cargar la API de YouTube
      const tag = document.createElement("script");
      tag.src = "https://www.youtube.com/iframe_api";
      document.head.appendChild(tag);
    </script>
  </head>
  <body>
    <div id="player"></div>
  </body>
</html>
