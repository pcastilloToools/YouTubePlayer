<!DOCTYPE html>
<html style="height:100%;">
  <body style="margin:0; background:black; height:100%;">
    <div id="player" style="width:100%; height:100%;"></div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
    // Variables globales para el estado del reproductor
    var player;
    var playerReady = false;
    window.unityPlayerStatus = {
        ready: false,
        lastUpdate: new Date().getTime(),
        currentState: -1 // -1: no inicializado, 0: terminado, 1: reproduciendo, 2: pausado
    };

    function onYouTubeIframeAPIReady() {
        console.log("JS: YouTube API lista. Inicializando reproductor...");
        
        const params = new URLSearchParams(window.location.search);
        const videoId = params.get("videoId") || "dQw4w9WgXcQ"; // ID de video por defecto

        player = new YT.Player('player', {
            width: '100%',
            height: '100%',
            videoId: videoId,
            playerVars: {
                'controls': 0,
                'modestbranding': 1,
                'autoplay': 0,
                'enablejsapi': 1 // IMPORTANTE: Habilita la API JS
            },
            events: {
                'onReady': onPlayerReady,
                'onStateChange': onPlayerStateChange,
                'onError': onPlayerError
            }
        });
    }

    function onPlayerReady(event) {
        console.log("JS: Reproductor listo!");
        playerReady = true;
        updateUnityStatus();
        
        // Notificar a Unity si es posible
        try {
            if (typeof unityObject !== 'undefined') {
                unityObject.sendMessage('OnYouTubePlayerReady');
            }
        } catch(e) { console.log("JS: Unity bridge no disponible"); }
    }

    function onPlayerStateChange(event) {
        console.log("JS: Estado cambiado:", event.data);
        updateUnityStatus();
    }

    function onPlayerError(event) {
        console.error("JS: Error en reproductor:", event.data);
        window.unityPlayerStatus.error = event.data;
    }

    function updateUnityStatus() {
        if (!player) return;
        
        window.unityPlayerStatus = {
            ready: playerReady,
            lastUpdate: new Date().getTime(),
            currentState: player.getPlayerState(),
            currentTime: player.getCurrentTime(),
            duration: player.getDuration()
        };
        console.log("JS: Estado actualizado para Unity:", window.unityPlayerStatus);
    }

    // Funciones de control EXPORTADAS
    function playVideo() {
        console.log("JS: Recibido comando PLAY");
        if (player && player.playVideo) {
            player.playVideo();
            updateUnityStatus();
        } else {
            console.warn("JS: playVideo - Reproductor no disponible");
        }
    }

    function pauseVideo() {
        console.log("JS: Recibido comando PAUSE");
        if (player && player.pauseVideo) {
            player.pauseVideo();
            updateUnityStatus();
        } else {
            console.warn("JS: pauseVideo - Reproductor no disponible");
        }
    }

    function togglePlayPause() {
        console.log("JS: Recibido comando TOGGLE");
        if (!player) return;
        
        if (player.getPlayerState() === YT.PlayerState.PLAYING) {
            pauseVideo();
        } else {
            playVideo();
        }
    }

    // Funci√≥n para verificar estado (usada por Unity)
    function getPlayerStatus() {
        return window.unityPlayerStatus;
    }
    </script>
  </body>
</html>
