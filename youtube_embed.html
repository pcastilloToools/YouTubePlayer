<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Youtube IFrame API</title>
    <script>
      // Stub para evitar errores si UnityBridge no est√° disponible todav√≠a
      if (!window.UnityBridge) {
        console.warn("UnityBridge no est√° disponible. Usando stub temporal.");
        window.UnityBridge = {
          onMessage: function (msg) {
            console.log("UnityBridge stub recibi√≥:", msg);
          },
        };
      }

      let player;
      let isPlayerReady = false;

      function onYouTubeIframeAPIReady() {
        console.log("‚úÖ API de YouTube lista.");
        player = new YT.Player("player", {
          height: "390",
          width: "640",
          videoId: "M7lc1UVf-VE", // Puedes cambiar este ID
          events: {
            onReady: onPlayerReady,
            onStateChange: onPlayerStateChange,
          },
        });
      }

      function onPlayerReady(event) {
        console.log("‚úÖ Reproductor listo.");
        isPlayerReady = true;

        // Play autom√°tico cuando est√© listo
        event.target.playVideo();

        // Avisamos a Unity
        postMessageToUnity("PLAYER_READY");
      }

      function onPlayerStateChange(event) {
        console.log("üé¨ Estado del reproductor:", event.data);
      }

      function playVideo() {
        if (isPlayerReady && player) player.playVideo();
      }

      function pauseVideo() {
        if (isPlayerReady && player) player.pauseVideo();
      }

      // M√©todo seguro para comunicarse con Unity
      function postMessageToUnity(message) {
        if (window.UnityBridge && typeof window.UnityBridge.onMessage === "function") {
          window.UnityBridge.onMessage(message);
        } else {
          console.warn("UnityBridge no est√° disponible para enviar el mensaje:", message);
        }
      }

      // Carga de la API de YouTube
      const tag = document.createElement("script");
      tag.src = "https://www.youtube.com/iframe_api";
      document.head.appendChild(tag);
    </script>
  </head>
  <body>
    <div id="player"></div>
  </body>
</html>
