<!DOCTYPE html>
<html style="height:100%;">
  <body style="margin:0; background:black; height:100%;">
    <div id="player" style="width:100%; height:100%;"></div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
    // Variables globales
    var player;
    var playerReady = false;
    window.playerStatus = { ready: false };
    
    // Función para actualizar estado
    function updatePlayerStatus() {
        window.playerStatus = {
            ready: playerReady,
            state: player ? player.getPlayerState() : -1,
            time: player ? player.getCurrentTime() : 0
        };
        console.log("JS: Estado actualizado:", window.playerStatus);
    }

    function onYouTubeIframeAPIReady() {
        console.log("JS: YouTube API lista");
        
        player = new YT.Player('player', {
            videoId: 'dQw4w9WgXcQ',
            playerVars: {
                'controls': 0,
                'enablejsapi': 1,
                'autoplay': 0
            },
            events: {
                'onReady': function(event) {
                    console.log("JS: Reproductor listo");
                    playerReady = true;
                    updatePlayerStatus();
                    
                    // Notificar a Unity
                    if (window.unityBridge) {
                        unityBridge.notify("PLAYER_READY");
                    }
                },
                'onStateChange': function(event) {
                    updatePlayerStatus();
                }
            }
        });
    }

    // Función para Unity
    function unityCommand(cmd, param) {
        try {
            if (!player) return "Player not ready";
            
            switch(cmd) {
                case 'play': 
                    player.playVideo();
                    return "Playing";
                case 'pause':
                    player.pauseVideo();
                    return "Paused";
                case 'toggle':
                    return player.getPlayerState() === 1 ? 
                        (player.pauseVideo(), "Paused") : 
                        (player.playVideo(), "Playing");
                default:
                    return "Unknown command";
            }
        } catch(e) {
            return "Error: " + e.message;
        }
    }
    </script>
  </body>
</html>
